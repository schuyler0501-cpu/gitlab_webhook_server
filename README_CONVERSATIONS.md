# 有效对话记录系统

## 🎯 功能说明

当你在对话中使用 `[有效对话]` 标识时，AI 会自动将对话保存到 `.cursor/conversations.md` 文件中，建立长久持续的记忆。

## 🚀 快速使用

### 基本用法

在对话中直接使用 `[有效对话]` 标识：

```
[有效对话] 我偏好使用中文注释，所有公开函数必须有中文注释
```

AI 会自动：
1. ✅ 识别 `[有效对话]` 标识
2. ✅ 获取当前北京时间
3. ✅ 保存对话到 `.cursor/conversations.md`
4. ✅ 在回复中确认已保存

### 保存格式

对话会以以下格式保存：

```markdown
## 对话记录 - 2024-01-15 14:30:25

### 用户
我偏好使用中文注释，所有公开函数必须有中文注释

### AI 回复
好的，我会记住你的偏好。以后生成代码时，我会确保所有公开函数都有中文注释...

---
```

## 📝 使用场景

### 1. 保存代码风格偏好

```
[有效对话] 我偏好使用中文注释，所有公开函数必须有中文注释说明功能
```

### 2. 保存项目要求

```
[有效对话] Webhook 处理要求：所有事件必须记录完整日志，包括事件类型、项目名称、提交数量
```

### 3. 保存开发习惯

```
[有效对话] 新功能开发时，我习惯先写测试，再实现功能
```

### 4. 保存技术决策

```
[有效对话] 数据库操作统一使用 GORM，不使用原生 SQL
```

## 🔄 工作机制

### AI 处理流程

```
用户发送消息（包含 [有效对话]）
    ↓
AI 识别标识
    ↓
AI 获取当前北京时间
    ↓
AI 生成回复
    ↓
AI 保存对话到 .cursor/conversations.md
    ↓
AI 确认保存
```

### 历史对话回顾

**每次对话开始时**，AI 会：

1. 📖 读取 `.cursor/conversations.md` 文件
2. 🔍 回顾历史有效对话
3. 💡 提取关键信息（偏好、要求、习惯等）
4. 🎯 应用到当前对话中

## 📁 文件结构

```
.cursor/
├── conversations.md           # 有效对话历史记录（自动生成）
├── conversations.backup.md    # 备份文件（自动生成）
├── memory.md                  # 用户记忆（手动维护）
└── conversation_handler.md    # 处理机制说明
```

## 🛠️ 维护建议

### 定期审查

建议每月审查一次历史对话：

1. **提取重要内容**: 将重要的偏好和要求提取到 `.cursor/memory.md`
2. **删除过时内容**: 删除不再适用的对话记录
3. **归档旧对话**: 如果文件过大，归档到 `.cursor/conversations_archive.md`

### 文件大小管理

- 如果文件超过 100KB，考虑归档旧对话
- 只保留最近 3-6 个月的对话记录
- 重要对话可以提取到 `.cursor/memory.md`

### 备份

- 历史对话文件应该提交到 Git
- 定期备份重要对话

## 💡 最佳实践

### ✅ 推荐使用

- 代码风格偏好
- 项目特定要求
- 开发习惯
- 技术决策
- 常用模式

### ❌ 不推荐使用

- 临时性问题
- 一次性的代码片段
- 已经解决的问题
- 过于具体的实现细节

## 🔍 查看历史对话

### 方法 1: 直接查看文件

打开 `.cursor/conversations.md` 文件查看所有历史对话。

### 方法 2: 使用命令行

```bash
# 查看最近 10 条对话
tail -n 100 .cursor/conversations.md

# 搜索特定主题
grep -i "注释" .cursor/conversations.md

# 统计对话数量
grep -c "## 对话记录" .cursor/conversations.md
```

### 方法 3: 在对话中询问

```
@memory 查看: 我保存的所有关于代码风格的偏好
```

## 📊 统计信息

可以添加统计功能查看：

- 对话总数
- 最近对话时间
- 最常讨论的主题
- 用户偏好变化趋势

## ❓ 常见问题

### Q: 如何删除某条对话记录？

A: 直接编辑 `.cursor/conversations.md` 文件，删除对应的对话记录。

### Q: 对话记录会占用很多空间吗？

A: 每条对话记录大约 1-2KB，100 条对话约 100-200KB。如果文件过大，可以归档旧对话。

### Q: 如何确保 AI 回顾历史对话？

A: AI 在每次对话开始时会自动读取 `.cursor/conversations.md` 文件。如果 AI 没有回顾，可以在对话中提醒："请先回顾历史有效对话"。

### Q: 可以批量导入历史对话吗？

A: 可以，直接编辑 `.cursor/conversations.md` 文件，按照格式添加对话记录即可。

### Q: 时间显示不正确怎么办？

A: 确保系统时区设置正确。AI 会使用系统时间转换为北京时间（UTC+8）。

## 🎯 与记忆系统的关系

- **`.cursor/conversations.md`**: 自动记录所有有效对话（详细、完整）
- **`.cursor/memory.md`**: 手动维护的重要偏好和要求（精简、核心）

建议：
- 使用 `[有效对话]` 记录所有重要对话
- 定期将核心内容提取到 `.cursor/memory.md`
- 两者结合使用，建立完整的记忆系统

---

**提示**: 使用 `[有效对话]` 标识，让 AI 记住你的重要偏好和要求，建立长久持续的记忆！

