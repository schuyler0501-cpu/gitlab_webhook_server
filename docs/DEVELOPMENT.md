# å¼€å‘è§„èŒƒæ–‡æ¡£

## ğŸ“‹ ç›®å½•ç»“æ„

```
gitlab_webhook_server/
â”œâ”€â”€ cmd/                    # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ server/            # æœåŠ¡å™¨ä¸»ç¨‹åº
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ router/           # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ commit/       # æäº¤ç›¸å…³æœåŠ¡
â”‚   â””â”€â”€ logger/           # æ—¥å¿—å·¥å…·
â”œâ”€â”€ pkg/                   # å¯å¯¹å¤–æš´éœ²çš„åŒ…ï¼ˆå¦‚æœæœ‰ï¼‰
â”œâ”€â”€ test/                  # æµ‹è¯•æ•°æ®
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ bin/                   # ç¼–è¯‘è¾“å‡ºï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ go.mod                 # Go æ¨¡å—å®šä¹‰
```

## ğŸ¯ ä»£ç è§„èŒƒ

### 1. å‘½åè§„èŒƒ

- **åŒ…å‘½å**: ä½¿ç”¨å°å†™å­—æ¯ï¼Œç®€çŸ­æœ‰æ„ä¹‰ï¼Œå¦‚ `handler`, `service`
- **æ–‡ä»¶å‘½å**: ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œå¦‚ `webhook_handler.go`
- **ç±»å‹å‘½å**: ä½¿ç”¨ PascalCaseï¼Œå¦‚ `WebhookHandler`, `CommitRecord`
- **å‡½æ•°/å˜é‡å‘½å**: ä½¿ç”¨ camelCaseï¼Œå¦‚ `handleWebhook`, `commitService`
- **å¸¸é‡å‘½å**: ä½¿ç”¨ PascalCase æˆ– UPPER_SNAKE_CASEï¼Œå¦‚ `MaxRetries`, `DEFAULT_PORT`

### 2. ä»£ç ç»„ç»‡

- **åˆ†å±‚æ¶æ„**: Handler â†’ Service â†’ Repository/Data Layer
- **å•ä¸€èŒè´£**: æ¯ä¸ªåŒ…/æ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **æ¥å£ä¼˜å…ˆ**: ä½¿ç”¨æ¥å£å®šä¹‰æœåŠ¡å¥‘çº¦ï¼Œä¾¿äºæµ‹è¯•å’Œæ‰©å±•

### 3. æ³¨é‡Šè§„èŒƒ

```go
// HandleWebhook å¤„ç† GitLab Webhook è¯·æ±‚
// éªŒè¯ tokenï¼Œè§£æè¯·æ±‚ä½“ï¼Œå¹¶è°ƒç”¨æœåŠ¡å±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
func (h *WebhookHandler) HandleWebhook(c *gin.Context) {
    // å®ç°ä»£ç 
}
```

### 4. é”™è¯¯å¤„ç†

- å§‹ç»ˆæ£€æŸ¥é”™è¯¯å¹¶é€‚å½“å¤„ç†
- ä½¿ç”¨ `fmt.Errorf` æˆ– `errors.Wrap` æ·»åŠ ä¸Šä¸‹æ–‡
- è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¸è¦é™é»˜å¿½ç•¥

```go
if err != nil {
    logger.Error("æ“ä½œå¤±è´¥", zap.Error(err))
    return fmt.Errorf("æ“ä½œå¤±è´¥: %w", err)
}
```

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµ

### 1. å®‰è£…ä¾èµ–

```bash
# ä¸‹è½½ä¾èµ–
go mod download

# æ•´ç†ä¾èµ–
go mod tidy
```

### 2. å¼€å‘æ¨¡å¼

```bash
# ä½¿ç”¨ Air çƒ­é‡è½½ï¼ˆæ¨èï¼‰
make dev

# æˆ–ç›´æ¥è¿è¡Œ
go run cmd/server/main.go
```

### 3. ä»£ç æ£€æŸ¥

```bash
# è¿è¡Œ linter
make lint

# æ ¼å¼åŒ–ä»£ç 
make fmt
```

### 4. æ„å»ºé¡¹ç›®

```bash
# æ„å»º
make build

# è¿è¡Œ
make run
```

### 5. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test ./internal/handler/...
```

## ğŸ“ Git æäº¤è§„èŒƒ

å»ºè®®ä½¿ç”¨ä»¥ä¸‹æ ¼å¼çš„æäº¤ä¿¡æ¯ï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type ç±»å‹**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

**ç¤ºä¾‹**:
```
feat(webhook): æ·»åŠ  GitLab Push äº‹ä»¶å¤„ç†

å®ç°äº† Push Hook äº‹ä»¶çš„æ¥æ”¶å’Œå¤„ç†é€»è¾‘ï¼Œ
åŒ…æ‹¬æäº¤è®°å½•çš„è§£æå’Œå­˜å‚¨ã€‚

Closes #123
```

## ğŸ¤– AI è¾…åŠ©å¼€å‘æç¤º

### ä¸ AI åä½œçš„æœ€ä½³å®è·µ

1. **æ¸…æ™°çš„ä¸Šä¸‹æ–‡**: åœ¨æé—®æ—¶æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
2. **å…·ä½“çš„é—®é¢˜**: æ˜ç¡®è¯´æ˜ä½ æƒ³è¦å®ç°çš„åŠŸèƒ½
3. **ä»£ç å¼•ç”¨**: ä½¿ç”¨æ–‡ä»¶è·¯å¾„å’Œè¡Œå·å¼•ç”¨ç°æœ‰ä»£ç 
4. **è¿­ä»£å¼€å‘**: åˆ†æ­¥éª¤å®ç°åŠŸèƒ½ï¼Œé€æ­¥å®Œå–„

### ç¤ºä¾‹æç¤ºè¯

âœ… **å¥½çš„æç¤º**:
```
åœ¨ internal/service/commit/commit_service.go ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œ
æ ¹æ®ä½œè€…é‚®ç®±å’Œæ—¶é—´èŒƒå›´æŸ¥è¯¢æäº¤è®°å½•ï¼Œå¹¶è¿”å›ç»Ÿè®¡ä¿¡æ¯ã€‚
```

âŒ **ä¸å¥½çš„æç¤º**:
```
å¸®æˆ‘å†™ä¸ªæŸ¥è¯¢åŠŸèƒ½
```

## ğŸ” è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨æ—¥å¿—**: ä½¿ç”¨ `zap` æ—¥å¿—åº“è®°å½•å…³é”®ä¿¡æ¯
2. **å•å…ƒæµ‹è¯•**: ä¸ºæ¯ä¸ªåŠŸèƒ½ç¼–å†™æµ‹è¯•
3. **æ¥å£æµ‹è¯•**: ä½¿ç”¨ Postman æˆ– curl æµ‹è¯• API

## ğŸ“š ç›¸å…³èµ„æº

- [Go å®˜æ–¹æ–‡æ¡£](https://go.dev/doc/)
- [Gin æ¡†æ¶æ–‡æ¡£](https://gin-gonic.com/docs/)
- [GitLab Webhook æ–‡æ¡£](https://docs.gitlab.com/ee/user/project/integrations/webhooks.html)
- [Uber Zap æ—¥å¿—åº“](https://github.com/uber-go/zap)

## ğŸ› ï¸ æ¨èå·¥å…·

- **Air**: çƒ­é‡è½½å·¥å…·ï¼Œ`go install github.com/cosmtrek/air@latest`
- **golangci-lint**: ä»£ç æ£€æŸ¥å·¥å…·ï¼Œ`go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest`
- **goimports**: è‡ªåŠ¨å¯¼å…¥ç®¡ç†ï¼Œ`go install golang.org/x/tools/cmd/goimports@latest`
